<div class="d-flex flex-row mt-5">
  <nav class="navbar bg-ligh w-100">
    <button [routerLink]="['/create', projects != null && projects.length>0 ? 'PROJECT' : 'TASK']" class="btn btn-outline-primary ms-3">CREATE</button>
    <div >
      <form class="d-flex flex-row" role="search">
        <input id="request" class="form-control" type="search" placeholder="Chercher un projet" aria-label="Search" [(ngModel)]="request" name="request">
        <button class="btn btn-outline-primary ms-3" type="submit" (click)="onSend()">Search</button>
      </form>
    </div>        
  </nav>
</div>

<table id="main" class="table table-responsive table-hover mt-5">
  <thead>
    <tr>
      <ng-container *ngIf="projects != null && projects.length>0">
        <th scope="col">#</th>
        <th scope="col">Project</th>
        <th scope="col">Description</th>
        <th scope="col">Type</th>
        <th scope="col">User</th>
        <th scope="col">Edit</th>
      </ng-container>
      <ng-container *ngIf="tasks != null && tasks.length>0">
        <th scope="col">#</th>
        <th scope="col">Title</th>
        <th scope="col">Description</th>
        <th scope="col">Status</th>
        <th scope="col">Duration</th>
        <th scope="col">Difficulty</th>
        <th scope="col">Progress</th>
        <th scope="col">EstimatedTime</th>
        <th scope="col">Project</th>
        <th scope="col">Project</th>
      </ng-container>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngIf="projects != null && projects.length>0">
      <tr *ngFor="let project of projects; let currentIndex = index">
        <th scope="row" [routerLink]="['../projects', project.id, 'tasks' ]">{{project.id}}</th>
        <td [routerLink]="['../projects', project.id, 'tasks' ]">{{project.name}}</td>
        <td [routerLink]="['../projects', project.id, 'tasks' ]">{{project.description}}</td>
        <td [routerLink]="['../projects', project.id, 'tasks' ]"><span [ngStyle]="{'color': project.projectType == 0 ? 'purple' : 'red'}"> {{project.projectType}}</span></td>
        <td [routerLink]="['../projects', project.id, 'tasks' ]" class="text-center">{{project.user.username | uppercase }}</td>
        <td class="text-center">
          
          <svg xmlns="http://www.w3.org/2000/svg" data-bs-toggle="modal" data-toggle="modal" [attr.data-bs-target]="'#exampleModal' + project.id"  width="16" height="16" fill="#6C63FF" class="bi bi-pencil-fill" viewBox="0 0 16 16">
            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
          </svg>
        </td>
        <div 
        class="modal fade" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1" [id]="'exampleModal'+project.id" >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalToggleLabel">Edit Project</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form #projectTemplateForm="ngForm" (ngSubmit)="onSubmit(projectTemplateForm)">
                <div class="form-group">
                  <input type="text" class="form-control" id="project-id" name="id" [ngModel]="project.id" hidden value={{project.id}}>
                </div>
                <div class="mb-3 form-group">
                  <label for="project-name" class="col-form-label">Project name:</label>
                  <input type="text" class="form-control" id="project-name" name="name" [ngModel]="project.name" required value={{project.name}}>
                </div>
                <div class="mb-3 form-group">
                  <label for="description-text" class="col-form-label">Description:</label>
                  <textarea class="form-control" id="description-text"  name="description" [ngModel]="project.description" required >{{project.description}}</textarea>
                </div>
                <div class="form-group">
                  <label for="description-text" class="col-form-label">Choose the type of the project:</label>
                  <select class="form-select" aria-label="Project Type"  name="projectType" [ngModel]="project.projectType" required>
                    <option *ngFor="let item of keys(); let i = index">{{ item }}</option></select>
                </div>
                <div class="form-group">
                  <input type="text" class="form-control" id="project-user" name="user" [ngModel]="project.user" hidden value={{project.user.username}}>
                </div>
                  
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger me-2 my-2" [attr.data-bs-target]="'#exampleModalToggle2'+project.id" data-bs-toggle="modal" data-bs-dismiss="modal">Delete</button>
                    <button type="button" class="btn btn-outline-secondary me-2 my-2" [attr.data-bs-target]="'#exampleModalToggle'+project.id" data-bs-toggle="modal" data-bs-dismiss="modal">Cancel</button>
                    <div class="form-group">
                      <button type="submit" class="btn btn-outline-success my-2" [attr.data-bs-target]="'#exampleModal'+project.id" data-bs-toggle="modal" data-bs-dismiss="modal">Submit</button>
                    </div>
                </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" [id]="'exampleModalToggle2'+project.id" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalToggleLabel2">Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Are you sure to delete this project? We won't be able to retrieve it later!
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" (click)="deleteProject(project.id)" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal" data-bs-dismiss="modal">Delete Project</button>
              </div>
            </div>
          </div>
        </div>
      </tr>
      
    </ng-container>
    <ng-container *ngIf="tasks != null && tasks.length>0">
      <tr *ngFor="let task of tasks; let currentIndex = index">
        <th scope="row">{{task.id}}</th>
        <td [ngStyle]="isFinished(task.status)">{{task.title}}</td>
        <td [ngStyle]="isFinished(task.status)">{{task.description}}</td>
        <td [ngStyle]="isFinished(task.status)" ><span [ngStyle]="onStyleTask(task.status)">{{task.status}}</span></td>
        <td [ngStyle]="isFinished(task.status)" class="text-center">{{task.duration}}</td>
        <td [ngStyle]="isFinished(task.status)" class="text-center">{{task.difficulty}}</td>
        <td [ngStyle]="isFinished(task.status)" class="text-center">{{task.progress}}</td>
        <td [ngStyle]="isFinished(task.status)" class="text-center">{{task.estimatedTime}}</td>
        <td [ngStyle]="isFinished(task.status)" class="text-center">{{task.project}}</td>
        <td [ngStyle]="isFinished(task.status)" class="text-center">
          <svg href="#exampleModalToggle" xmlns="http://www.w3.org/2000/svg"  data-bs-toggle="modal" data-bs-target="#exampleModalToggle" data-bs-whatever="@mdo" width="16" height="16" fill="#6C63FF" class="bi-primary bi-pencil-fill" viewBox="0 0 16 16">
            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
          </svg></td>
          <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalToggleLabel">Edit Task</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form>
                    <div class="mb-3">
                      <label for="project-name" class="col-form-label">Title:</label>
                      <input type="text" class="form-control" id="project-name" value={{task.title}}>
                    </div>
                    <div class="mb-3">
                      <label for="description-text" class="col-form-label">Description:</label>
                      <textarea class="form-control" id="description-text">{{task.description}}</textarea>
                    </div>
                    <select class="form-select my-4" aria-label="Task Status">
                      <option selected>Update the status type</option>
                      <option value="STARTED">STARTED</option>
                      <option value="PAUSED">PAUSED</option>
                      <option value="CANCELED">CANCELED</option>
                      <option value="FINISHED">FINISHED</option>
                    </select>
                    <div class="mb-3">
                      <label for="difficulty-text" class="col-form-label">Difficulty:</label>
                      <textarea class="form-control" id="difficulty-text">{{task.difficulty}}</textarea>
                    </div>
                    <div class="mb-3">
                      <label for="progress-text" class="col-form-label">Progress:</label>
                      <textarea class="form-control" id="progress-text">{{task.progress}}</textarea>
                    </div>
                    <div class="mb-3">
                      <label for="estimation-text" class="col-form-label">Estimated Time:</label>
                      <textarea class="form-control" id="estimation-text">{{task.estimatedTime}}</textarea>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-outline-danger me-2 my-2" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal" data-bs-dismiss="modal">Delete</button>
                  <button type="button" class="btn btn-outline-secondary me-2 my-2" data-bs-target="#exModal" data-bs-toggle="modal" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-outline-success my-2" data-bs-target="#exampleM" data-bs-toggle="modal" data-bs-dismiss="modal">Save</button>
                </div>
              </div>
            </div>
          </div>
          <div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalToggleLabel2">Delete</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  Are you sure to delete this project? We won't be able to retrieve it later!
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-outline-danger" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal" data-bs-dismiss="modal">Delete Project</button>
                </div>
              </div>
            </div>
          </div>
        </tr>
      </ng-container>
    </tbody>
  </table>
